<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sample">

	<select
		id="boardList" resultType="first.sample.vo.BoardVO">
			SELECT distinct IDX, TITLE, HIT_CNT, CREA_DTM, CREA_ID,
			<!-- ** 댓글숫자표시 -->
            (SELECT COUNT(*) FROM tbl_reply WHERE IDX=b.IDX) AS recnt
			FROM tb_board b, tbl_member m
			<!-- WHERE절을 include 태그로 삽입 -->
    		<include refid="search"></include>
			and DEL_GB = 'N'
			ORDER BY IDX DESC
			limit #{start}, 10 <!-- start부터 10개 게시물 -->
	</select>

<!-- sql code 조각 -->
<!-- 반복되는 sql의 일부를 sql태그를 이용하여 따로 빼둘수 있다. -->
<sql id="search">
    <choose>
        <!-- 검색옵션이 전체 검색일 경우 -->
        <when test="searchOption == 'all'">
            WHERE CREA_ID like '%${keyword}%'
            OR CONTENTS like '%${keyword}%'
            OR TITLE like '%${keyword}%'
        </when>
        <!-- 전체 검색이 아닐 경우 -->
        <otherwise>
            WHERE ${searchOption} like '%${keyword}%'
        </otherwise>
    </choose>
</sql>	

<select id="countArticle" resultType="int">
    SELECT COUNT(*) FROM TB_BOARD
    <include refid="search"></include>
</select> 


	<insert id="insertBoard">
			INSERT INTO TB_BOARD 
			( TITLE, 
			CONTENTS, 
			HIT_CNT, 
			DEL_GB, 
			CREA_DTM, 
			CREA_ID ) 
			VALUES 
			( #{TITLE}, 
			#{CONTENTS}, 
			0, 
			'N', 
			SYSDATE(), 
			#{CREA_ID}
			)
	</insert>

	<update
		id="updateHitCnt"> 
			UPDATE TB_BOARD 
			SET HIT_CNT = ifnull(HIT_CNT, 0) + 1 
			WHERE IDX = #{IDX} 
	</update>
	
	<select
		id="selectBoardDetail" resultType="first.sample.vo.BoardVO">
		 	SELECT IDX, HIT_CNT, CREA_ID, CREA_DTM, TITLE, CONTENTS 
			 FROM TB_BOARD 
			 WHERE IDX = #{IDX} 
	</select>

	<select
		id="UpdateBoardDetail" resultType="first.sample.vo.BoardVO">
		 	SELECT IDX, HIT_CNT, CREA_ID, CREA_DTM, TITLE, CONTENTS 
			 FROM TB_BOARD 
			 WHERE IDX = #{iDX} 
	</select>	
	
	<update
		id="updateBoard"> 
			UPDATE TB_BOARD 
			SET TITLE = #{TITLE},
			    CONTENTS = #{CONTENTS}
			WHERE IDX = #{IDX} 
	</update>
	
	
	
	<insert id="insertDelBoard">
			INSERT INTO DEL_TB_BOARD 
			select *
			from TB_BOARD
			WHERE IDX = #{IDX}
	</insert>
	
	
	<delete
		id="deleteBoard">  
			UPDATE TB_BOARD 
			SET DEL_GB = 'Y'
			WHERE IDX = #{IDX} 
	</delete>


</mapper>